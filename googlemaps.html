<!DOCTYPE html>
<html>
<title>W3.CSS Template</title>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" media="screen" href="assets/css/form.css">



    <style>
        body {
            font-family: "Raleway", Arial, sans-serif
        }

        .w3-row img {
            margin-bottom: -8px
        }
    </style>
</head>


<h3>My Google Maps Demo</h3>
<!--The div element for the map -->
<div id="map"></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.map"></script> -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    // this is all from cloudinary  the url to where we will save our images
    var CLOUDNARY_URL = "https://api.cloudinary.com/v1_1/ronwab/upload";
    //upload preset in cloudinary https://cloudinary.com/console/settings/upload  scroll to upload presets
    var CLOUDNARY_UPLOAD_PRESET = "ffghjylr";
    //imgPreview is an image i had on the screen
    var imgPreview = document.getElementById("img-preview");
    //this creates the thingi to upload the images https://www.w3schools.com/tags/att_input_type_file.asp
    // I am not sure why they use "for" in the  body tag
    var fileUpload = document.getElementById("file-upload");
    //Adding an event listener called change.. I think we could also have used click..
    //This syntax i believe is vanila JS. we can always tweak it to jquery if we need to
    fileUpload.addEventListener("change", function (event) {
        event.preventDefault();
        //saving the response back from clicking the button
        var file = event.target.files[0];
        //FormData() is built in JS to help create key value pairs that can be used to send data
        // https://developer.mozilla.org/en-US/docs/Web/API/FormData
        var formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", CLOUDNARY_UPLOAD_PRESET);
        //similar to ajax Tried using ajax but was getting an error that I did not understand :-(
        // $.ajax({
        axios({
            // see line 25
            url: CLOUDNARY_URL,
            // POST request pushes img to where ever we are saving
            method: "POST",
            //not sure about this guy
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            //not sure about this guy
            data: formData
            //This is just a callback function
        }).then(function (res) {
            console.log(res);
            // setting returned results to the imgPreview
            imgPreview.src = res.data.secure_url;
        });
    });
</script>

<script src="https://www.gstatic.com/firebasejs/5.9.4/firebase.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.map"></script> -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<!-- <script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyCQUPXI0N7-b4bOpNlb6n8ML1p6YW5VJ48",
        authDomain: "ronwab-8dbcd.firebaseapp.com",
        databaseURL: "https://ronwab-8dbcd.firebaseio.com",
        projectId: "ronwab-8dbcd",
        storageBucket: "ronwab-8dbcd.appspot.com",
        messagingSenderId: "148535054528"
    };
    firebase.initializeApp(config);
    var selectedFile;
    var locationCoodsvals = "/";
    var myLatLng;
    $("#file-upload").on("change", function (e) {
        e.preventDefault();
        selectedFile = e.target.files[0];
        uploadFile();
    });

    function uploadFile() {
        var filename = selectedFile.name;
        console.log(filename);
        // Create a root reference
        var storageRef = firebase.storage().ref("/TestImages/" + filename);
        var uploadTask = storageRef.put(selectedFile);
    }
    var filename = "img1.jpg";
    var imgRef = firebase.storage().ref("/TestImages/" + filename);
    $("#downloadbutton").on("click", function (e) {
        imgRef.getDownloadURL().then(function (url) {
            console.log(url);
            console.log(e);
            var imageOnPage = $("displayImages");
            imageOnPage.append(url);
            console.log("here");
            console.log(imageOnPage);
        });
    });
</script>

<script>
    function initMap() {
        var map = new google.maps.Map(document.getElementById("map"), {
            zoom: 11,
            center: {
                lat: Number(33.7490),
                lng: Number(-84.3880)
            }
        });
        var myLatLng = firebase.database().ref("/");
        myLatLng.on("value", function (snapChot) {
            // TODO:
            // Firebase values coming here
            var data = snapChot
        .val(); // { rahdnkey: { locationCoodsvals: {} }, anyotherrahdnkey: { locationCoodsvals: {} } }
            for (var key in data) {
                let userLocation = data[key].locationCoodsvals;
                console.log("My Lat LG: ", userLocation);
                var marker = new google.maps.Marker({
                    position: userLocation,
                    map: map,
                    title: "Hello World!"
                });
            }
        });
    }
</script>
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDq2hOQHj-qstNYUsl7a8kHOtrkeJVhdro&callback=initMap"></script> -->